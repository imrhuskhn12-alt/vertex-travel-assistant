import streamlit as st
import logging
import google.auth
from google.cloud import aiplatform
from vertexai.generative_models import GenerativeModel, Content, Part
import vertexai

# Configuration
PROJECT_ID = "project-d89fc0ae-b263-4a82-8bf"
REGION = "us-central1"
GEMINI_MODEL_NAME = "gemini-2.5-flash"

# Initialize Vertex AI
vertexai.init(project=PROJECT_ID, location=REGION)

# System instructions for the travel assistant
system_instructions = """
You are WanderBot, a knowledgeable and friendly travel assistant chatbot. Your role is to help travelers with:

1. **Destination Recommendations**: Suggest travel destinations based on the traveler's interests, budget, and travel dates.
2. **Travel Planning**: Provide advice on itineraries, best times to visit, and travel duration recommendations.
3. **Cultural Insights**: Share information about local customs, traditions, and cultural etiquette.
4. **Practical Information**: Help with visa requirements, currency information, local transportation, and safety tips.
5. **Accommodations & Dining**: Recommend hotels, hostels, and local restaurants based on preferences.
6. **Activities & Attractions**: Suggest popular and hidden gems, museums, natural landmarks, and adventure activities.
7. **Travel Tips**: Provide packing advice, language tips, and budgeting guidance.

Be enthusiastic, encouraging, and provide accurate information. If you're unsure about specific details, acknowledge it and suggest where the user can find more information.
Always tailor your responses to the user's travel style and preferences.
"""

def call_model(prompt: str, model_name: str) -> str:
    """
    This function interacts with Vertex AI Generative Model to generate text based on a given prompt.
    """
    try:
        model = GenerativeModel(
            model_name=model_name,
            system_instruction=system_instructions
        )
        
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        logging.error(f"API Error: {e}")
        return f"I'm sorry, I encountered an error processing your request: {e}"

# --- Streamlit UI ---
st.set_page_config(page_title="WanderBot", page_icon="üåç")
st.title("üåç WanderBot - Travel Assistant Chatbot")

st.write("Welcome to WanderBot! I'm your friendly travel assistant powered by Google Gemini 2.5 Flash.")
st.write("Ask me about destinations, travel tips, cultural information, or anything travel-related!")

# Initialize chat history in session state
if "chat_history" not in st.session_state:
    st.session_state.chat_history = []

# Display chat messages
for message in st.session_state.chat_history:
    with st.chat_message(message["role"]):
        st.markdown(message["content"])

# Chat input
user_input = st.chat_input("Ask me about travel destinations...")
if user_input:
    # Add user message to chat history
    st.session_state.chat_history.append({"role": "user", "content": user_input})
    
    # Display user message
    with st.chat_message("user"):
        st.markdown(user_input)
    
    # Get and display assistant response
    with st.chat_message("assistant"):
        with st.spinner("Thinking..."):
            response = call_model(user_input, GEMINI_MODEL_NAME)
            st.markdown(response)
            st.session_state.chat_history.append({"role": "assistant", "content": response})
